
\newpage


\newgeometry{margin=1cm}
\begin{landscape}
    {
        \titleformat{\section}
        {\normalfont\Large\bfseries}{\llap{\parbox{0em}{\thesection\hfill}}}{3em}{}

        \section{Requirements table}

    }

    \begin{longtable}{|p{1cm}|p{19cm}|p{2cm}|p{3cm}|}
        \hline
        \rowcolor[HTML]{9B9B9B}
        id                                        & description                                                                                                                                                                                                                                                                           & Satisfied by function & Implemented by component                 \\ \hline
        \endfirsthead
        %
        \endhead
        %
        \rowcolor[HTML]{C0C0C0}        R1         & The system shall implement git and git-lfs repositories over SSH.                                                                                                                                                                                                                     &                       &                                          \\ \hline
        \rowcolor[HTML]{DDFFDD}        R1.1       & The system shall serve all regular git commands (clone, push, pull, etc.).                                                                                                                                                                                                            & F1.2, F3              & Git server                               \\ \hline
        \rowcolor[HTML]{DDFFDD}        R1.2       & The system shall allow for SSH git authentication.                                                                                                                                                                                                                                    & F1.1                  & sshd, gitolite                           \\ \hline
        \rowcolor[HTML]{DDFFDD}        R1.3       & The system shall implement the git-lfs batch/objects API.                                                                                                                                                                                                                             & F1.3                  & git lfs server                           \\ \hline
        \rowcolor[HTML]{EEFFEE}        R1.3.1     & the server shall accept a get request on route /objects/batch?repo=... with payload matching the payload from \url{https://github.com/git-lfs/git-lfs/blob/main/docs/api/batch.md#requests}                                                                                           &                       &                                          \\\hline
        \rowcolor[HTML]{EEFFEE}        R1.3.2     & the server shall return for route objects\_batch the operation, the hash\_algo, and an array of objects containing presigned links to perform a download/upload operation, according to the \url{https://github.com/git-lfs/git-lfs/blob/main/docs/api/batch.md#successful-responses} &                       &                                          \\\hline
        \rowcolor[HTML]{EEFFEE}        R1.3.3     & In case of error generating the link, the error returned should be embedded into the response (the request shall not fail) according to the \url{https://github.com/git-lfs/git-lfs/blob/main/docs/api/batch.md#successful-responses}. The error shall be one of                      &                       &                                          \\\hline
        \rowcolor[HTML]{EEFFEE}        R1.3.4     & In case of failure leading to global failure of the request, the server shall return the appropriate HTTP status code and a json object containing a message property. Only the following errors shall happen:                                                                        &                       &                                          \\\hline
        \rowcolor[HTML]{FFDDDD}        R1.4       & The system shall implement the git-lfs locks API.                                                                                                                                                                                                                                     & F1.4                  & Git lfs server                           \\ \hline
        \rowcolor[HTML]{C0C0C0}        R2         & The system shall be usable as a low-level foundation for commercial and non-commercial multi-users applications based around git repositories.                                                                                                                                        &                       &                                          \\ \hline
        \rowcolor[HTML]{DDFFDD}        R2.1       & The system shall allow for per-repository access control, including read and write access.                                                                                                                                                                                            & F2                    & Gitolite                                 \\ \hline
        \rowcolor[HTML]{EEFFEE}        R2.1.1     & The authentication and authorization subsystem shall be able to verify if a given user has read or write access to a given repository.                                                                                                                                                &                       &                                          \\ \hline
        \rowcolor[HTML]{EEFFEE}        R2.1.2     & The authentication and authorization subsystem shall expose a command named \textit{git-lfs-authenticate}, which will return a json web token signing the user, the repository, the operation, and the expiration date.                                                               &                       &                                          \\ \hline
        \rowcolor[HTML]{EEFFEE}        R2.1.3     & The lfs server shall accept and verify a json web token signing the user, the repository, the operation, and the expiration date.                                                                                                                                                     & F5.1                  &                                          \\ \hline
        \rowcolor[HTML]{EEFFEE}        R2.1.4     & The lfs server shall be able to generate a signed link for a given file, operation, and expiration date that can't be modified by the user.                                                                                                                                           & F5.2                  &                                          \\ \hline
        \rowcolor[HTML]{EEFFEE}        R2.1.5     & The file server (either the lsf info server acting as a proxy or the storage server directly) shall be able to verify a signed link for a given file, operation, and expiration date, and serve or accept the requested file, depending on the operation.                             & F5.3                  &                                          \\ \hline
        \rowcolor[HTML]{DDDDDD}        R2.2       & The system shall store data files in a separate storage location.                                                                                                                                                                                                                     &                       & Postgres, Minio                          \\ \hline
        \rowcolor[HTML]{EEFFEE}        R2.2.1     & The system shall implement the storage interfaces of \textbf{R2.3.1} for the MinIO API, using a Single Bucket Storage policy (SBS)                                                                                                                                                    & F6                    &                                          \\\hline
        \rowcolor[HTML]{FFEEEE}        R2.2.2     & The system shall implement the storage interfaces of \textbf{R2.3.1} for the local file system API                                                                                                                                                                                    & F6                    &                                          \\\hline
        \rowcolor[HTML]{FFEEEE}        R2.2.3     & The system shall implement the lock storage interfaces of \textbf{R2.3.3} for the MinIO API, using a Single Bucket Storage policy (SBS)                                                                                                                                               & F4                    &                                          \\\hline
        \rowcolor[HTML]{FFEEEE}        R2.2.4     & The system shall implement the lock storage interfaces of \textbf{R2.3.3} for postgresql database                                                                                                                                                                                     & F4                    &                                          \\\hline
        \rowcolor[HTML]{DDDDDD}        R2.3       & Components of the system shall be reusable in other systems.                                                                                                                                                                                                                          &                       &                                          \\ \hline
        \rowcolor[HTML]{EEFFEE}        R2.3.1     & The system shall define file storage interfaces, to retrieve metadata about a file, to retrieve a file, and to store a file.                                                                                                                                                          & F6                    &                                          \\\hline
        \rowcolor[HTML]{FFEEEE}        R2.3.2     & The system shall model implementations of the storage interfaces of \textbf{R2.3.1} for other storages: Multiple Bucket Storage policy (MBS), and File Transfer Protocol (FTP), and local storage with database stored metadata (LSDB)                                                & F6                    &                                          \\\hline
        \rowcolor[HTML]{FFEEEE}        R2.3.3     & The system shall define lock storage interfaces, to create, list, and delete locks.                                                                                                                                                                                                   & F4                    &                                          \\\hline
        \rowcolor[HTML]{FFEEEE}        R2.3.4     & The system shall model implementations of the lock storage interfaces of \textbf{R2.3.3} for other storages: Locks in multiple buckets (LMB), Locks in local file storage.                                                                                                            & F4                    &                                          \\\hline
        \rowcolor[HTML]{DDFFDD}        R2.4       & The system repositories and users shall be configurable by a single administrator actor (other authorized system or actual person).                                                                                                                                                   & F7                    & Gitolite                                 \\ \hline
        \rowcolor[HTML]{DDFFDD}        R2.5       & The system shall use compatible licences, and be loosely coupled enough so the licences of components do not contaminate each other.                                                                                                                                                  &                       &                                          \\ \hline
        \rowcolor[HTML]{DDFFDD}        R2.6       & The system shall not use deprecated components.                                                                                                                                                                                                                                       &                       &                                          \\ \hline
        \rowcolor[HTML]{DDFFDD}        R2.7       & Abstraction done of the network layer between the client and the system, the system shall handle an initial push of a 100MB of LFS as 100 large files in less than one minute.                                                                                                        &                       &                                          \\ \hline
        \rowcolor[HTML]{C0C0C0}        R3         & The system shall be developed in 200 hours-man by the end of October 2023, and require at most 100 hours-man per year to be maintained by the community..                                                                                                                             &                       &                                          \\ \hline
        \rowcolor[HTML]{FFDDDD}        R3.1       & A first implementation of the system shall be implemented by the end of September 2023                                                                                                                                                                                                &                       &                                          \\ \hline
        \rowcolor[HTML]{DDFFDD}        R3.2       & The system shall ensure memory safety and functional correctness either by being heavily maintained by the community, by formal technics, or by automated testing.                                                                                                                    &                       &                                          \\ \hline
        \rowcolor[HTML]{EEFFEE}        R3.2.1     & Custom parts of the system shall be implemented in the rust programming language.                                                                                                                                                                                                     &                       & git-lfs-authenticate command; lfs server \\\hline
        \rowcolor[HTML]{EEFFEE}        R3.2.2     & Non custom parts of the system shall be heavily adopted by the community to be considered safe.                                                                                                                                                                                       &                       & gitolite, git, nginx, ...                \\\hline
        \rowcolor[HTML]{EEFFEE}        R3.2.3     & Custom parts of the system shall be tested using automated testing, with a coverage of at least 90\%.                                                                                                                                                                                 &                       & git-lfs-authenticate command; lfs server \\\hline
        \rowcolor[HTML]{DDFFDD}        R3.3       & Every custom code shall adhere to a common and well-recognized good practices handbook, to be chosen.                                                                                                                                                                                 &                       & git-lfs-authenticate command; lfs server \\ \hline
        \rowcolor[HTML]{EEFFEE}        R3.3.1     & Custom apis of the system should adhere to the following good practices handbooks \url{https://rust-lang.github.io/api-guidelines/}, \url{https://cheats.rs/#idiomatic-rust} and \url{https://rust-unofficial.github.io/patterns/}                                                    &                       &                                          \\\hline
        \rowcolor[HTML]{EEFFEE}        R3.3.2     & Custom code of the system shall use the linter \url{https://github.com/rust-lang/rust-clippy}                                                                                                                                                                                         &                       &                                          \\\hline
        \rowcolor[HTML]{FFDDDD}        R3.4       & The system shall be documented focussing on: the system in its whole, the system components, maintenance processes.                                                                                                                                                                   &                       &                                          \\ \hline
        \rowcolor[HTML]{FFEEEE}        R3.4.1     & Every custom and non-custom code of the system shall be documented in term of context and role in the system, and in term of possible replacements.                                                                                                                                   &                       &                                          \\\hline
        \rowcolor[HTML]{FFEEEE}        R3.4.2     & The system shall be documented in term of architecture, and in term of maintenance processes.                                                                                                                                                                                         &                       &                                          \\\hline
        \rowcolor[HTML]{FFEEEE}        R3.4.3     & The system shall be documented in term of deployment processes.                                                                                                                                                                                                                       &                       &                                          \\\hline
        \rowcolor[HTML]{FFEEEE}        R3.4.4     & Custom code of the system shall be documented in term of technical choices and design.                                                                                                                                                                                                &                       &                                          \\\hline
        \rowcolor[HTML]{C0C0C0}        R4         & The system shall be deployable in less than 1h in an enterprise-grade environment.                                                                                                                                                                                                    &                       &                                          \\ \hline
        \rowcolor[HTML]{DDFFDD}        R4.1       & The system shall be deployable in conteneurised linux environments in a reproducible and documented way.                                                                                                                                                                              &                       & Docker, docker-compose                   \\ \hline
        \rowcolor[HTML]{DDFFDD}        R4.2       & Only the lock API, the batch API, and the git commands shall be exposed to the outside.                                                                                                                                                                                               &                       & Nginx                                    \\ \hline
        \rowcolor[HTML]{DDFFDD}        R4.3       & The authorization systems shall not share state between the git server and the git-lfs server or the storage server.                                                                                                                                                                  &                       & git-lfs authenticate command, lfs server \\ \hline
        \rowcolor[HTML]{FFDDDD}        R4.4       & The administrator of the system shall be able to define resource limits for the bandwidth, the storage, and the number of requests, separated between the target points (lfs, git), and discriminated by user and repository.                                                         &                       &                                          \\ \hline
        \rowcolor[HTML]{FFDDDD}        R4.5       & The system shall do regular backups of the data.                                                                                                                                                                                                                                      &                       &                                          \\ \hline
    \end{longtable}
\end{landscape}

\titleformat{\section}
{\normalfont\Large\bfseries}{\llap{\parbox{\titleindent}{\thesection\hfill}}}{0em}{}

\newgeometry{left=3cm,right=3cm,top=3cm,bottom=5cm}

\subsection{What's next}

The previous table show that the core is now implemented. The next step will be to 

\begin{itemize}
    \item Implement the locks API
    \item Add new storage backends (local file storage, mainly)
    \item Further documentation shall be written.
    \item Backups and resource limits shall be implemented.
\end{itemize}
